% ============================================================================
% æ•°å­—äººè§†é¢‘ç”Ÿæˆç³»ç»Ÿè®ºæ–‡ - ç³»ç»Ÿæ¶æ„å›¾è¡¨æ–‡ä»¶
% ============================================================================
% æ³¨æ„ï¼šæ­¤æ–‡ä»¶éœ€è¦åœ¨ä¸»æ–‡æ¡£ä¸­åŒ…å«ï¼Œå®åŒ…å£°æ˜åº”åœ¨ä¸»æ–‡æ¡£ä¸­è¿›è¡Œ
% å¦‚æœå•ç‹¬ä½¿ç”¨æ­¤æ–‡ä»¶ï¼Œè¯·ç¡®ä¿åœ¨ \documentclass ä¹‹åæ·»åŠ ä»¥ä¸‹å®åŒ…ï¼š
%   \usepackage{tikz}
%   \usetikzlibrary{shapes,arrows,positioning,calc,shapes.geometric,chains}
% ============================================================================

% ============================================================================
% å›¾1ï¼šç³»ç»Ÿäº”å±‚æ¶æ„å›¾
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.9,
        node distance=1.5cm,
        auto,
        font=\small,
        box/.style={rectangle, draw, thick, minimum width=7cm, minimum height=0.8cm,
                    text centered, fill=blue!10},
        title/.style={text centered, font=\large\bfseries},
        arrow/.style={->, thick, line width=1.5pt}
    ]

    % æ ‡é¢˜
    \node[title] at (3.5, 9) {ç³»ç»Ÿäº”å±‚åˆ†å±‚æ¶æ„è®¾è®¡};

    % å±•ç¤ºå±‚
    \node[box, fill=cyan!20] (presentation) at (3.5, 7.5) {
        \textbf{å±•ç¤ºå±‚ï¼ˆPresentation Layerï¼‰}\\
        Streamlit Web UI (Port 8501)
    };

    % HTTP é€šä¿¡
    \node[text centered] at (3.5, 6.8) {$\Downarrow$ HTTP REST é€šä¿¡ $\Downarrow$};

    % API å±‚
    \node[box, fill=green!20] (api) at (3.5, 6) {
        \textbf{API å±‚ï¼ˆAPI Layerï¼‰}\\
        FastAPI + Uvicorn (Port 8001)
    };

    % å‡½æ•°è°ƒç”¨
    \node[text centered] at (3.5, 5.3) {$\Downarrow$ å‡½æ•°è°ƒç”¨ $\Downarrow$};

    % æœåŠ¡å±‚
    \node[box, fill=yellow!20, minimum width=8cm] (service) at (3.5, 4.5) {
        \textbf{æœåŠ¡å±‚ï¼ˆService Layerï¼‰}\\
        TaskManager | StateManager | ModelRegistry
    };

    % å‡½æ•°è°ƒç”¨
    \node[text centered] at (3.5, 3.8) {$\Downarrow$ å‡½æ•°è°ƒç”¨ $\Downarrow$};

    % æ¨ç†å±‚
    \node[box, fill=orange!20, minimum width=8cm] (inference) at (3.5, 3) {
        \textbf{æ¨ç†å±‚ï¼ˆInference Layerï¼‰}\\
        Hallo2 Pipeline | æ•°æ®å¤„ç†å™¨
    };

    % å‡½æ•°è°ƒç”¨
    \node[text centered] at (3.5, 2.3) {$\Downarrow$ å‡½æ•°è°ƒç”¨ $\Downarrow$};

    % æ¨¡å‹å±‚
    \node[box, fill=red!20, minimum width=8cm] (model) at (3.5, 1.5) {
        \textbf{æ¨¡å‹å±‚ï¼ˆModel Layerï¼‰}\\
        PyTorch + CUDA + é¢„è®­ç»ƒæ¨¡å‹
    };

    % å³ä¾§è¯´æ˜
    \node[text centered, anchor=west] at (11.5, 7.5) {\small \textbf{ç”¨æˆ·äº¤äº’}};
    \node[text centered, anchor=west, font=\tiny] at (11.5, 7.1) {æ–‡ä»¶ä¸Šä¼ ã€å‚æ•°é…ç½®};

    \node[text centered, anchor=west] at (11.5, 6) {\small \textbf{è¯·æ±‚å¤„ç†}};
    \node[text centered, anchor=west, font=\tiny] at (11.5, 5.6) {å‚æ•°éªŒè¯ã€è·¯ç”±};

    \node[text centered, anchor=west] at (11.5, 4.5) {\small \textbf{ä¸šåŠ¡é€»è¾‘}};
    \node[text centered, anchor=west, font=\tiny] at (11.5, 4.1) {ä»»åŠ¡ç®¡ç†ã€çŠ¶æ€ç®¡ç†};

    \node[text centered, anchor=west] at (11.5, 3) {\small \textbf{æ ¸å¿ƒæ¨ç†}};
    \node[text centered, anchor=west, font=\tiny] at (11.5, 2.6) {æ¨¡å‹æ‰§è¡Œã€æ•°æ®å¤„ç†};

    \node[text centered, anchor=west] at (11.5, 1.5) {\small \textbf{ç¡¬ä»¶åŸºç¡€}};
    \node[text centered, anchor=west, font=\tiny] at (11.5, 1.1) {æ·±åº¦å­¦ä¹ æ¡†æ¶};

    \end{tikzpicture}
    \caption{æ•°å­—äººè§†é¢‘ç”Ÿæˆç³»ç»Ÿäº”å±‚åˆ†å±‚æ¶æ„}
    \label{fig:system_architecture_layers}
\end{figure}

% ============================================================================
% å›¾2ï¼šä»»åŠ¡çŠ¶æ€æœºå›¾
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=1,
        node distance=2cm,
        auto,
        state/.style={circle, draw, thick, minimum width=1.5cm, text centered},
        transition/.style={->, thick, bend left},
        font=\small
    ]

    % æ ‡é¢˜
    \node[text centered] at (3.5, 4.5) {\large \textbf{ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº}};

    % çŠ¶æ€èŠ‚ç‚¹
    \node[state, fill=yellow!40] (pending) at (1, 2.5) {Pending\\(ç­‰å¾…)};
    \node[state, fill=cyan!40] (running) at (3.5, 2.5) {Running\\(è¿è¡Œ)};
    \node[state, fill=green!40] (completed) at (6, 2.5) {Completed\\(å®Œæˆ)};
    \node[state, fill=red!40] (failed) at (6, 0.5) {Failed\\(å¤±è´¥)};

    % çŠ¶æ€è½¬ç§»
    \draw[transition] (pending) to node[above] {submit} (running);
    \draw[transition] (running) to node[above] {success} (completed);
    \draw[transition] (running) to node[right] {error} (failed);
    \draw[transition] (pending) to node[left] {cancel} (failed);

    % è¯´æ˜æ–‡å­—
    \node[text centered, font=\tiny] at (1, 1.5) {APIå·²æ¥å—\\ç­‰å¾…æ‰§è¡Œ};
    \node[text centered, font=\tiny] at (3.5, 1.5) {æ¨ç†è¿›è¡Œä¸­\\å®æ—¶æ›´æ–°è¿›åº¦};
    \node[text centered, font=\tiny] at (6, 1.5) {è§†é¢‘å·²ç”Ÿæˆ\\å¯ä¸‹è½½};
    \node[text centered, font=\tiny] at (6, -0.5) {æ¨ç†å¤±è´¥\\ä¿å­˜é”™è¯¯æ—¥å¿—};

    \end{tikzpicture}
    \caption{ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸçŠ¶æ€æœº}
    \label{fig:task_state_machine}
\end{figure}

% ============================================================================
% å›¾3ï¼šå®Œæ•´æ•°æ®æµç¨‹å›¾
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.8,
        node distance=1.5cm,
        auto,
        font=\small,
        flow_box/.style={rectangle, draw, thick, minimum width=2.5cm, minimum height=0.6cm,
                         text centered},
        process/.style={rounded rectangle, draw, thick, minimum width=2.5cm,
                        minimum height=0.6cm, text centered},
        arrow/.style={->, thick}
    ]

    % ç¬¬ä¸€è¡Œï¼šç”¨æˆ·å’Œå‰ç«¯
    \node[flow_box, fill=cyan!20] (user) at (1, 7) {ç”¨æˆ·};
    \node[process, fill=cyan!30] (upload) at (1, 5.5) {ä¸Šä¼ å›¾åƒ\\å’ŒéŸ³é¢‘};

    % ç¬¬äºŒè¡Œï¼šå‰ç«¯å¤„ç†
    \node[process, fill=green!30] (validate) at (1, 4) {å‚æ•°éªŒè¯\\æ–‡ä»¶æ£€æŸ¥};
    \node[process, fill=green!30] (request) at (3.5, 4) {HTTP POST\\è¯·æ±‚};

    % ç¬¬ä¸‰è¡Œï¼šAPI å±‚
    \node[process, fill=yellow!30] (api_process) at (3.5, 2.5) {API éªŒè¯\\åˆ›å»ºä»»åŠ¡};
    \node[process, fill=yellow!30] (queue) at (6, 2.5) {åŠ å…¥\\ä»»åŠ¡é˜Ÿåˆ—};

    % ç¬¬å››è¡Œï¼šåå°å¤„ç†
    \node[process, fill=orange!30] (preprocess) at (1.5, 1) {é¢„å¤„ç†};
    \node[process, fill=orange!30] (inference) at (3.5, 1) {æ¨ç†};
    \node[process, fill=orange!30] (postprocess) at (5.5, 1) {åå¤„ç†};

    % ç¬¬äº”è¡Œï¼šè¾“å‡º
    \node[process, fill=red!30] (save) at (3.5, -0.5) {ä¿å­˜è§†é¢‘};
    \node[flow_box, fill=cyan!20] (download) at (5.5, -0.5) {ç”¨æˆ·ä¸‹è½½};

    % è¿æ¥ç®­å¤´
    \draw[arrow] (user) -- (upload);
    \draw[arrow] (upload) -- (validate);
    \draw[arrow] (validate) -- (request);
    \draw[arrow] (request) -- (api_process);
    \draw[arrow] (api_process) -- (queue);
    \draw[arrow] (queue) -- (preprocess);
    \draw[arrow] (preprocess) -- (inference);
    \draw[arrow] (inference) -- (postprocess);
    \draw[arrow] (postprocess) -- (save);
    \draw[arrow] (save) -- (download);

    % å›ç¨‹ç®­å¤´ï¼ˆå®æ—¶æ›´æ–°ï¼‰
    \draw[dashed, arrow] (queue.north) -- (1.5, 3) -- (1, 3.5) [out=90];
    \node[font=\tiny] at (0.5, 3.2) {è½®è¯¢};

    \node[text centered] at (3.5, 8) {\textbf{å®Œæ•´çš„æ•°æ®æµç¨‹}};

    \end{tikzpicture}
    \caption{ç”¨æˆ·è¯·æ±‚åˆ°è§†é¢‘è¾“å‡ºçš„å®Œæ•´æ•°æ®æµç¨‹}
    \label{fig:complete_data_flow}
\end{figure}

% ============================================================================
% å›¾4ï¼šHallo2 æ¨ç†ç®¡é“ä¸‰é˜¶æ®µæµç¨‹
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=1,
        node distance=2cm,
        auto,
        stage_box/.style={rectangle, draw=thick, fill=blue!20, minimum width=2.2cm,
                          minimum height=1cm, text centered},
        process_box/.style={rectangle, draw, fill=green!20, minimum width=1.8cm,
                            minimum height=0.5cm, text centered, font=\tiny},
        arrow/.style={->, thick, line width=1.5pt}
    ]

    % æ ‡é¢˜
    \node[text centered] at (6, 5.5) {\Large \textbf{Hallo2 æ¨ç†ç®¡é“ä¸‰é˜¶æ®µæµç¨‹}};

    % è¾“å…¥
    \node at (0.8, 4) {\textbf{è¾“å…¥}};
    \node[process_box] (img) at (0.8, 3.3) {äººç‰©å›¾åƒ};
    \node[process_box] (audio) at (0.8, 2.5) {éŸ³é¢‘æ–‡ä»¶};

    % é˜¶æ®µ1ï¼šé¢„å¤„ç†
    \node[stage_box, fill=cyan!30] (stage1) at (3, 3) {
        \textbf{é¢„å¤„ç†}\\
        \small Preprocessing
    };
    \node[process_box, fill=cyan!20] at (3, 1.8) {äººè„¸æ£€æµ‹\\æ©ç ç”Ÿæˆ};
    \node[process_box, fill=cyan!20] at (3, 1.2) {éŸ³é¢‘åˆ†ç¦»\\ç‰¹å¾æå–};

    % ç®­å¤´
    \draw[arrow] (img) -- (1.8, 3);
    \draw[arrow] (audio) -- (1.8, 2.5);
    \draw[arrow] (1.8, 3) -- (3, 3);

    % é˜¶æ®µ2ï¼šæ¨ç†
    \node[stage_box, fill=orange!30] (stage2) at (6, 3) {
        \textbf{æ¨ç†}\\
        \small Inference
    };
    \node[process_box, fill=orange!20] at (6, 1.8) {VAEç¼–ç \\æ¡ä»¶èåˆ};
    \node[process_box, fill=orange!20] at (6, 1.2) {æ‰©æ•£é€†å‘\\ç”Ÿæˆè§†é¢‘};

    \draw[arrow] (stage1) -- (stage2);

    % é˜¶æ®µ3ï¼šåå¤„ç†
    \node[stage_box, fill=red!30] (stage3) at (9, 3) {
        \textbf{åå¤„ç†}\\
        \small Postprocessing
    };
    \node[process_box, fill=red!20] at (9, 1.8) {VAEè§£ç \\è§†é¢‘ç¼–ç };
    \node[process_box, fill=red!20] at (9, 1.2) {éŸ³é¢‘æ··åˆ\\æ–‡ä»¶è¾“å‡º};

    \draw[arrow] (stage2) -- (stage3);

    % è¾“å‡º
    \node at (11.2, 3) {\textbf{è¾“å‡º}};
    \draw[arrow] (stage3) -- (11.2, 3.3);
    \node[process_box, fill=green!40] at (11.2, 2.5) {MP4è§†é¢‘æ–‡ä»¶};

    \end{tikzpicture}
    \caption{Hallo2 æ¨ç†ç®¡é“ä¸‰é˜¶æ®µæµç¨‹ï¼ˆé¢„å¤„ç†-æ¨ç†-åå¤„ç†ï¼‰}
    \label{fig:hallo2_pipeline}
\end{figure}

% ============================================================================
% å›¾5ï¼šæ¨¡å—ä¾èµ–å…³ç³»å›¾
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.9,
        node distance=1.5cm,
        auto,
        module/.style={rectangle, draw, thick, fill=blue!20, minimum width=1.5cm,
                       minimum height=0.6cm, text centered, font=\small},
        core/.style={rectangle, draw, thick, fill=red!30, minimum width=1.8cm,
                     minimum height=0.6cm, text centered, font=\small},
        dependency/.style={->, thick, dashed},
        arrow/.style={->, thick}
    ]

    % æ ‡é¢˜
    \node[text centered] at (4.5, 7.5) {\Large \textbf{æ ¸å¿ƒæ¨¡å—ä¾èµ–å…³ç³»}};

    % æ ¸å¿ƒæ¨¡å—
    \node[core] (api) at (1.5, 6) {FastAPI\\App};
    \node[module] (task_mgr) at (1.5, 4.5) {TaskManager};
    \node[module] (state_mgr) at (4.5, 4.5) {StateManager};
    \node[module] (model_reg) at (7.5, 4.5) {ModelRegistry};

    % æ¨ç†æ¨¡å—
    \node[module] (pipeline) at (4.5, 3) {Hallo2Pipeline};

    % å¤„ç†å™¨æ¨¡å—
    \node[module] (img_proc) at (1.5, 1.5) {ImageProcessor};
    \node[module] (audio_proc) at (4.5, 1.5) {AudioProcessor};
    \node[module] (mask_proc) at (7.5, 1.5) {MaskProcessor};

    % ä¾èµ–å…³ç³»
    \draw[arrow] (api) -- (task_mgr);
    \draw[arrow] (api) -- (state_mgr);
    \draw[arrow] (task_mgr) -- (state_mgr);
    \draw[arrow] (task_mgr) -- (model_reg);

    \draw[arrow] (task_mgr) -- (pipeline);
    \draw[arrow] (model_reg) -- (pipeline);

    \draw[arrow] (pipeline) -- (img_proc);
    \draw[arrow] (pipeline) -- (audio_proc);
    \draw[arrow] (pipeline) -- (mask_proc);

    % è¯´æ˜
    \node[font=\tiny, text centered] at (1.5, 0.5) {å›¾åƒ\\é¢„å¤„ç†};
    \node[font=\tiny, text centered] at (4.5, 0.5) {éŸ³é¢‘\\é¢„å¤„ç†};
    \node[font=\tiny, text centered] at (7.5, 0.5) {æ©ç \\å¤„ç†};

    \end{tikzpicture}
    \caption{ç³»ç»Ÿæ ¸å¿ƒæ¨¡å—ä¾èµ–å…³ç³»}
    \label{fig:module_dependency}
\end{figure}

% ============================================================================
% å›¾6ï¼šGPU å†…å­˜ç®¡ç†æµç¨‹
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.85,
        node distance=1.2cm,
        auto,
        memory_box/.style={rectangle, draw, thick, fill=green!20, minimum width=2.2cm,
                           minimum height=0.55cm, text centered, font=\tiny},
        control_box/.style={rounded rectangle, draw, thick, fill=orange!20,
                            minimum width=2cm, minimum height=0.5cm, text centered, font=\tiny},
        arrow/.style={->, thick}
    ]

    % æ ‡é¢˜
    \node[text centered] at (5, 7.5) {\Large \textbf{GPU å†…å­˜ç®¡ç†æµç¨‹}};

    % ä¸Šè¡Œï¼šæ¨¡å‹åŠ è½½
    \node[control_box] (detect_gpu) at (2, 6.5) {æ£€æµ‹GPU};
    \node[memory_box] (allocate) at (2, 5.5) {åˆ†é…æ˜¾å­˜};
    \node[control_box] (lazy_load) at (2, 4.5) {å»¶è¿ŸåŠ è½½};
    \node[memory_box] (model_loaded) at (2, 3.5) {æ¨¡å‹å·²åŠ è½½};

    \draw[arrow] (detect_gpu) -- (allocate);
    \draw[arrow] (allocate) -- (lazy_load);
    \draw[arrow] (lazy_load) -- (model_loaded);

    % ä¸­é—´ï¼šæ¨ç†æ‰§è¡Œ
    \node[control_box] (inference) at (5, 5.5) {æ‰§è¡Œæ¨ç†};
    \node[memory_box] (temp_memory) at (5, 4.5) {ä¸´æ—¶æ˜¾å­˜å ç”¨};
    \node[control_box] (monitor) at (5, 3.5) {ç›‘æ§å ç”¨};

    \draw[arrow] (model_loaded) -- (inference);
    \draw[arrow] (inference) -- (temp_memory);
    \draw[arrow] (temp_memory) -- (monitor);

    % ä¸‹è¡Œï¼šå†…å­˜ç®¡ç†
    \node[control_box] (precision) at (8, 6.5) {å¤šç²¾åº¦æ”¯æŒ};
    \node[memory_box] (float_type) at (8, 5.5) {float32/16};
    \node[control_box] (checkpoint) at (8, 4.5) {æ¢¯åº¦æ£€æŸ¥ç‚¹};
    \node[memory_box] (optimize) at (8, 3.5) {æ˜¾å­˜ä¼˜åŒ–};

    \draw[arrow] (precision) -- (float_type);
    \draw[arrow] (float_type) -- (checkpoint);
    \draw[arrow] (checkpoint) -- (optimize);

    % æ¸…ç†é˜¶æ®µ
    \node[control_box] (cleanup) at (5, 2) {æ‰§è¡Œæ¸…ç†};
    \node[memory_box] (release) at (5, 0.8) {é‡Šæ”¾æ˜¾å­˜};

    \draw[arrow] (monitor) -- (cleanup);
    \draw[arrow] (optimize) -- (cleanup);
    \draw[arrow] (cleanup) -- (release);

    \end{tikzpicture}
    \caption{GPU æ˜¾å­˜ç®¡ç†æµç¨‹}
    \label{fig:gpu_memory_management}
\end{figure}

% ============================================================================
% å›¾7ï¼šå‰ç«¯ UI å¸ƒå±€
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.9,
        node distance=0.5cm,
        auto,
        ui_box/.style={rectangle, draw, thick, minimum width=6cm, minimum height=0.8cm,
                       text centered, font=\small},
        section/.style={rectangle, draw=thick, minimum width=5.8cm, minimum height=0.7cm,
                        text centered, font=\tiny, fill=blue!10}
    ]

    % æ ‡é¢˜
    \node[text centered] at (3.5, 9) {\Large \textbf{Streamlit å‰ç«¯ UI å¸ƒå±€}};

    % é¡µé¢æ¡†
    \draw[thick] (0.2, 8.2) rectangle (6.8, -0.5);

    % æ ‡é¢˜æ 
    \node[ui_box, fill=cyan!30] at (3.5, 7.5) {æ•°å­—äººè§†é¢‘ç”Ÿæˆç³»ç»Ÿ};

    % æ–‡ä»¶ä¸Šä¼ åŒº
    \node[section, fill=green!20] at (3.5, 6.8) {\textbf{ğŸ“ æ–‡ä»¶ä¸Šä¼ åŒº}};
    \node[section] at (3.5, 6.1) {$\square$ ä¸Šä¼ äººç‰©å›¾åƒ (JPG/PNG)};
    \node[section] at (3.5, 5.5) {$\square$ ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ (WAV/MP3)};

    % å‚æ•°é…ç½®åŒº
    \node[section, fill=orange!20] at (3.5, 4.9) {\textbf{âš™ï¸ å‚æ•°é…ç½®åŒº}};
    \node[section] at (3.5, 4.2) {$\bullet$ åˆ†è¾¨ç‡: $\square$ | å¸§ç‡: $\square$ | é•¿åº¦: $\square$};
    \node[section] at (3.5, 3.6) {$\bullet$ ç²¾åº¦: â—‰ float32 â—‹ float16 | $\square$ å¯ç”¨ç¼“å­˜};

    % æäº¤å’Œè¿›åº¦
    \node[section, fill=yellow!20] at (3.5, 3) {\textbf{â–¶ï¸ ä»»åŠ¡æäº¤}};
    \node[section] at (3.5, 2.4) {$[~~\text{ç”Ÿæˆè§†é¢‘}~~]$ è¿›åº¦: [=====>---] 65\%};

    % ç»“æœå±•ç¤º
    \node[section, fill=red!20] at (3.5, 1.8) {\textbf{ğŸ¬ ç»“æœå±•ç¤º}};
    \node[section] at (3.5, 1.2) {$[~~\text{ğŸ“¥ ä¸‹è½½è§†é¢‘}~~]$ çŠ¶æ€: ç”Ÿæˆå®Œæˆ};

    % ä»»åŠ¡å†å²
    \node[section, fill=purple!20] at (3.5, 0.6) {\textbf{ğŸ“‹ ä»»åŠ¡å†å²}};

    \end{tikzpicture}
    \caption{Streamlit å‰ç«¯ç”¨æˆ·ç•Œé¢å¸ƒå±€}
    \label{fig:frontend_ui_layout}
\end{figure}

% ============================================================================
% å›¾8ï¼šAPI ç«¯ç‚¹å’Œæ•°æ®æµ
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.85,
        node distance=1.5cm,
        auto,
        endpoint/.style={rectangle, draw, thick, fill=cyan!20, minimum width=2.2cm,
                         minimum height=0.6cm, text centered, font=\tiny},
        method/.style={text centered, font=\tiny\bfseries},
        arrow/.style={->, thick}
    ]

    % æ ‡é¢˜
    \node[text centered] at (4.5, 8.5) {\Large \textbf{FastAPI ç«¯ç‚¹æ¶æ„}};

    % å¥åº·æ£€æŸ¥ç»„
    \node[method] at (1.5, 7.5) {å¥åº·æ£€æŸ¥};
    \node[endpoint, fill=green!30] (health1) at (1.5, 6.8) {GET /health};
    \node[endpoint, fill=green!30] (health2) at (1.5, 6) {GET /api/v1/health};

    % æ¨ç†ç«¯ç‚¹ç»„
    \node[method] at (4.5, 7.5) {æ¨ç†ä»»åŠ¡};
    \node[endpoint, fill=blue!30] (inference_post) at (4.5, 6.8) {POST /inference/hallo2};
    \node[endpoint, fill=blue!30] (inference_config) at (4.5, 6) {POST /inference/config};

    % ä»»åŠ¡ç®¡ç†ç»„
    \node[method] at (7.5, 7.5) {ä»»åŠ¡ç®¡ç†};
    \node[endpoint, fill=orange!30] (tasks_list) at (7.5, 6.8) {GET /tasks};
    \node[endpoint, fill=orange!30] (task_status) at (7.5, 6) {GET /tasks/\{id\}};

    % æ¨¡å‹ç«¯ç‚¹ç»„
    \node[method] at (10.5, 7.5) {æ¨¡å‹ä¿¡æ¯};
    \node[endpoint, fill=purple!30] (models_list) at (10.5, 6.8) {GET /models};
    \node[endpoint, fill=purple!30] (model_info) at (10.5, 6) {GET /models/\{name\}};

    % ç»“æœä¸‹è½½
    \node[method] at (4.5, 4.5) {ç»“æœä¸‹è½½};
    \node[endpoint, fill=red!30] (download_video) at (4.5, 3.8) {GET /tasks/\{id\}/video};
    \node[endpoint, fill=red!30] (download_logs) at (4.5, 3) {GET /tasks/\{id\}/logs};

    % åˆ é™¤æ“ä½œ
    \node[endpoint, fill=red!30] (delete_task) at (7.5, 3.8) {DELETE /tasks/\{id\}};

    % æ•°æ®æµå‘ç®­å¤´
    \draw[arrow] (inference_post) -- (4.5, 5.2);
    \node[text centered, font=\tiny] at (3.5, 5.2) {æäº¤};

    \draw[arrow] (4.5, 5.2) -- (task_status);
    \node[text centered, font=\tiny] at (5.5, 5.5) {æŸ¥è¯¢};

    \draw[arrow] (task_status) -- (download_video);
    \node[text centered, font=\tiny] at (6.5, 4.5) {ä¸‹è½½};

    \end{tikzpicture}
    \caption{FastAPI ç«¯ç‚¹æ¶æ„å’Œæ•°æ®æµ}
    \label{fig:api_endpoints}
\end{figure}

% ============================================================================
% å›¾9ï¼šç³»ç»Ÿæ—¶åºå›¾ï¼ˆå®Œæ•´äº¤äº’è¿‡ç¨‹ï¼‰
% ============================================================================
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.8,
        node distance=1cm,
        auto,
        participant/.style={rectangle, draw, thick, minimum width=1.5cm, text centered, font=\small},
        lifeline/.style={dashed},
        message/.style={->, thick},
        arrow/.style={->, thick}
    ]

    % æ ‡é¢˜
    \node[text centered] at (6, 8.5) {\Large \textbf{ç³»ç»Ÿäº¤äº’æ—¶åºå›¾}};

    % å‚ä¸è€…
    \node[participant, fill=cyan!20] (user) at (1, 7.5) {ç”¨æˆ·};
    \node[participant, fill=green!20] (frontend) at (3, 7.5) {å‰ç«¯};
    \node[participant, fill=yellow!20] (api) at (5, 7.5) {API};
    \node[participant, fill=orange!20] (backend) at (7, 7.5) {åç«¯};
    \node[participant, fill=red!20] (gpu) at (9, 7.5) {GPU};

    % ç”Ÿå‘½çº¿
    \draw[lifeline] (1, 7) -- (1, 0.5);
    \draw[lifeline] (3, 7) -- (3, 0.5);
    \draw[lifeline] (5, 7) -- (5, 0.5);
    \draw[lifeline] (7, 7) -- (7, 0.5);
    \draw[lifeline] (9, 7) -- (9, 0.5);

    % äº¤äº’æ­¥éª¤
    \draw[message] (1, 6.5) -- (3, 6.3) node[midway, above, font=\tiny] {1. ä¸Šä¼ æ–‡ä»¶};
    \draw[message] (3, 5.9) -- (5, 5.7) node[midway, above, font=\tiny] {2. éªŒè¯};
    \draw[message] (5, 5.3) -- (7, 5.1) node[midway, above, font=\tiny] {3. åˆ›å»ºä»»åŠ¡};
    \draw[message] (5, 4.7) -- (3, 4.5) node[midway, above, font=\tiny] {4. è¿”å›ID};

    \draw[message] (7, 4.1) -- (9, 3.9) node[midway, above, font=\tiny] {5. æ¨ç†æ‰§è¡Œ};

    \draw[message, dashed] (3, 3.5) -- (5, 3.3) node[midway, above, font=\tiny] {6. è½®è¯¢è¿›åº¦};
    \draw[message, dashed] (5, 2.9) -- (3, 2.7) node[midway, above, font=\tiny] {7. è¿”å›è¿›åº¦};

    \draw[message] (3, 2.3) -- (1, 2.1) node[midway, above, font=\tiny] {8. æ›´æ–°UI};

    \draw[message] (9, 1.7) -- (7, 1.5) node[midway, above, font=\tiny] {9. æ¨ç†å®Œæˆ};
    \draw[message] (7, 1.1) -- (5, 0.9) node[midway, above, font=\tiny] {10. è¿”å›ç»“æœ};

    \end{tikzpicture}
    \caption{ç³»ç»Ÿå®Œæ•´äº¤äº’æ—¶åºå›¾}
    \label{fig:system_sequence}
\end{figure}

% ç»“æŸå›¾è¡¨å®šä¹‰
