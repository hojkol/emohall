\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        scale=0.85,
        node distance=1.2cm,
        auto,
        memory_box/.style={rectangle, draw, thick, fill=green!20, minimum width=2.2cm,
                           minimum height=0.55cm, text centered, font=\tiny},
        control_box/.style={rounded rectangle, draw, thick, fill=orange!20,
                            minimum width=2cm, minimum height=0.5cm, text centered, font=\tiny},
        arrow/.style={->, thick}
    ]

    % 标题
    \node[text centered] at (5, 7.5) {\Large \textbf{GPU 内存管理流程}};

    % 上行：模型加载
    \node[control_box] (detect_gpu) at (2, 6.5) {检测GPU};
    \node[memory_box] (allocate) at (2, 5.5) {分配显存};
    \node[control_box] (lazy_load) at (2, 4.5) {延迟加载};
    \node[memory_box] (model_loaded) at (2, 3.5) {模型已加载};

    \draw[arrow] (detect_gpu) -- (allocate);
    \draw[arrow] (allocate) -- (lazy_load);
    \draw[arrow] (lazy_load) -- (model_loaded);

    % 中间：推理执行
    \node[control_box] (inference) at (5, 5.5) {执行推理};
    \node[memory_box] (temp_memory) at (5, 4.5) {临时显存占用};
    \node[control_box] (monitor) at (5, 3.5) {监控占用};

    \draw[arrow] (model_loaded) -- (inference);
    \draw[arrow] (inference) -- (temp_memory);
    \draw[arrow] (temp_memory) -- (monitor);

    % 下行：内存管理
    \node[control_box] (precision) at (8, 6.5) {多精度支持};
    \node[memory_box] (float_type) at (8, 5.5) {float32/16};
    \node[control_box] (checkpoint) at (8, 4.5) {梯度检查点};
    \node[memory_box] (optimize) at (8, 3.5) {显存优化};

    \draw[arrow] (precision) -- (float_type);
    \draw[arrow] (float_type) -- (checkpoint);
    \draw[arrow] (checkpoint) -- (optimize);

    % 清理阶段
    \node[control_box] (cleanup) at (5, 2) {执行清理};
    \node[memory_box] (release) at (5, 0.8) {释放显存};

    \draw[arrow] (monitor) -- (cleanup);
    \draw[arrow] (optimize) -- (cleanup);
    \draw[arrow] (cleanup) -- (release);

    \end{tikzpicture}
    \caption{GPU 显存管理流程}
    \label{fig:gpu_memory_management}
\end{figure}
